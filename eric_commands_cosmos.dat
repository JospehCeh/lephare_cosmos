#! /bin/csh


#############
##  LIBRARY

$LEPHAREDIR/source/filter -c SCOSMOS.para 

#GAL CWW
$LEPHAREDIR/source/sedtolib -c SCOSMOS.para -t G -GAL_SED /home/nuss/00_labo/lsst/photoz/++lephare/LEPHARE/sed/GAL/CFHTLS_230506/CFHTLS_MOD.list  -GAL_LIB LIB_CWW 
$LEPHAREDIR/source/mag_gal  -c SCOSMOS.para -t G -GAL_LIB_IN LIB_CWW -GAL_LIB_OUT CWW_SCOSMOS -MOD_EXTINC 0,0 

#GAL VISTA
$LEPHAREDIR/source/sedtolib -c SCOSMOS.para -t G -GAL_SED COSMOS_MOD.list  -GAL_LIB LIB_VISTA 
$LEPHAREDIR/source/mag_gal  -c SCOSMOS.para -t G -GAL_LIB_IN LIB_VISTA -GAL_LIB_OUT VISTA_SCOSMOS -MOD_EXTINC 18,26,26,33,26,33,26,33  -EXTINC_LAW SMC_prevot.dat,SB_calzetti.dat,SB_calzetti_bump1.dat,SB_calzetti_bump2.dat 

#STAR
$LEPHAREDIR/source/sedtolib -c SCOSMOS.para -t S -STAR_SED STAR_MOD_ALL.list
$LEPHAREDIR/source/mag_gal -c SCOSMOS.para -t S -LIB_ASCII YES -STAR_LIB_OUT ALLSTAR_SCOSMOS -LIB_ASCII YES

#AGN
$LEPHAREDIR/source/sedtolib -c SCOSMOS.para -t Q -QSO_SED  $LEPHAREDIR/sed/QSO/SALVATO09/AGN_MOD.list
$LEPHAREDIR/source/mag_gal -c SCOSMOS.para -t Q -MOD_EXTINC 0,1000  -EB_V 0.,0.1,0.2,0.3 -EXTINC_LAW SB_calzetti.dat -LIB_ASCII YES


#BC03
$LEPHAREDIR/source/sedtolib -c SCOSMOS.para -t G -GAL_SED BC03_ASCII.list  -GAL_LIB LIB_BC03 -SEL_AGE AGE_BC03.dat
$LEPHAREDIR/source/mag_gal  -c SCOSMOS.para -t G -GAL_LIB_IN LIB_BC03 -GAL_LIB_OUT BC03_SCOSMOS -MOD_EXTINC 1,2 -EXTINC_LAW SB_calzetti.dat  -LIB_ASCII NO -Z_STEP 0.04,6,0.04

#IR LIB DALE
$LEPHAREDIR/source/sedtolib -c SCOSMOS.para -t G -GAL_SED DALE.list  -GAL_LIB LIB_DALE 


###################################################
# CALIBRATION
###################################################

#PHOTOZ APER_OFF + AUTO_OFF  VISTA 
$LEPHAREDIR/source/zphota -c SCOSMOS.para -CAT_IN cosmos_laigle.in  -CAT_OUT zphot_vista_adapt.out -ZPHOTLIB VISTA_SCOSMOS  -ADD_EMLINES 0,100 -AUTO_ADAPT YES  -EM_DISPERSION 50,5 -INP_TYPE M


#PHOTOZ APER_OFF + AUTO_OFF  VISTA 
$LEPHAREDIR/source/zphota -c SCOSMOS.para -CAT_IN ultravista_flux2_zcosmos.in  -CAT_OUT zphot_vista_adapt.out -ZPHOTLIB VISTA_SCOSMOS  -ADD_EMLINES 0,100 -AUTO_ADAPT YES  -EM_DISPERSION 50,5 -INP_TYPE F
$LEPHAREDIR/source/zphota -c SCOSMOS.para -CAT_IN ultravista_flux2_zcosmos.in  -CAT_OUT zphot_vista_shift.out -ZPHOTLIB VISTA_SCOSMOS  -ADD_EMLINES 0,100 -AUTO_ADAPT NO -APPLY_SYSSHIFT $SHIFT -EM_DISPERSION 50,5 -INP_TYPE F
$LEPHAREDIR/source/zphota -c SCOSMOS.para -CAT_IN ultravista_flux2_zcosmos.in  -CAT_OUT zphot_vista_nothing.out -ZPHOTLIB VISTA_SCOSMOS  -ADD_EMLINES 0,100  -AUTO_ADAPT NO  -EM_DISPERSION 50,5 -INP_TYPE F

$LEPHAREDIR/source/zphota -c SCOSMOS.para -CAT_IN ultravista_flux2_zcosmos.in  -CAT_OUT zphot_vista.out -ZPHOTLIB VISTA_SCOSMOS,ALLSTAR_SCOSMOS,QSO_SCOSMOS  -ADD_EMLINES 50,5  -AUTO_ADAPT NO  -EM_DISPERSION 50,5 -INP_TYPE F -SPEC_OUT YES


$LEPHAREDIR/source/zphota -c SCOSMOS.para -CAT_IN ultravista_flux2_zcosmos.in  -CAT_OUT zphot_vista.out -ZPHOTLIB CWW_SCOSMOS  -ADD_EMLINES 50,5  -AUTO_ADAPT NO  -EM_DISPERSION 50,5 -INP_TYPE F -SPEC_OUT YES


#Masses
$LEPHAREDIR/source/zphota -c SCOSMOS.para -CAT_IN  test.in  -CAT_OUT zphot_vista_adapt.out -ZPHOTLIB BC03_SCOSMOS  -ADD_EMLINES 0,100 -AUTO_ADAPT YES -APPLY_SYSSHIFT $SHIFT -EM_DISPERSION 50,5



#Coef ext MW

$LEPHAREDIR/source/filter_extinc -c SCOSMOS.para -f filter_cosmos.dat


awk '!(/^*/) && $140>0 && $140<6 {print $140,$2,$3,$4,$9,$10,$11}' zphot_vista_adapt.out > fichierJonathan.dat


data zphot_vista_adapt.out
read {zp 9 zs 142}
erase limits 0 1 0 1 box points zs zp
relocate 0 0 draw 6 6 

data zphot_vista_nothing.out
read {zp 9 zs 142}
erase limits 0 1 0 1 box points zs zp
relocate 0 0 draw 6 6 


data zphot_vista_shift.out
read {zp 9 zs 142}
erase limits 0 1 0 1 box points zs zp
relocate 0 0 draw 6 6 
